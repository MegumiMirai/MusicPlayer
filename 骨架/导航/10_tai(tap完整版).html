<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <link rel="stylesheet" href="css/tai.css">
</head>
<body>
    <div id="wrap">
        <div class="head">
            <div class="head-top">
                <h1 class="logo">
                    <a href="javascript:;">
                        <img src="img/logo.png" />
                    </a>
                </h1>
                <!--面包屑-->
                <a href="javascript:;" class="menuBtn"></a>
                <!--按钮组-->
                <div class="btns">
                    <a href="javascript:;" class="search">搜索</a>
                    <a href="javascript:;">登录</a>
                    <a href="javascript:;">注册</a>
                </div>
            </div>
            <div class="head-bottom">
                <!--搜索区-->
                <form method="post">
                    <input type="text" placeholder="请输入">
                    <input type="submit" value="搜索">
                </form>
            </div>
            <ul class="mask">
                <li>
                    <a href="javascript:;">首页</a>
                </li>
                <li>
                    <a href="javascript:;">MV</a>
                </li>
                <li>
                    <a href="javascript:;">悦单</a>
                </li>
                <li>
                    <a href="javascript:;">V榜</a>
                </li>
                <li>
                    <a href="javascript:;">音乐</a>
                </li>
                <li>
                    <a href="javascript:;">商场</a>
                </li>
                <li>
                    <a href="javascript:;">节目</a>
                </li>
                <li>
                    <a href="javascript:;">饭团</a>
                </li>
                <li>
                    <a href="javascript:;">咨询</a>
                </li>
                <li>
                    <a href="javascript:;">我的家</a>
                </li>
                <li>
                    <a href="javascript:;">APP下载</a>
                </li>
                <li>
                    <a href="javascript:;">热门应用</a>
                </li>
            </ul>
        </div>
        <div class="content">
            <div class="megumi-nav-drag-wrapper">
                <ul class="list">
                    <li>
                        <a href="javascript:;" class="active">首页</a>
                    </li>
                    <li>
                        <a href="javascript:;">MV</a>
                    </li>
                    <li>
                        <a href="javascript:;">悦单</a>
                    </li>
                    <li>
                        <a href="javascript:;">V榜</a>
                    </li>
                    <li>
                        <a href="javascript:;">音乐</a>
                    </li>
                    <li>
                        <a href="javascript:;">商场</a>
                    </li>
                    <li>
                        <a href="javascript:;">节目</a>
                    </li>
                    <li>
                        <a href="javascript:;">饭团</a>
                    </li>
                    <li>
                        <a href="javascript:;">咨询</a>
                    </li>
                    <li>
                        <a href="javascript:;">我的家</a>
                    </li>
                    <li>
                        <a href="javascript:;">APP下载</a>
                    </li>
                    <li>
                        <a href="javascript:;">热门应用</a>
                    </li>
                </ul>
            </div>
            <div class="carousel-wrap" needAuto needCarousel>
                <div class="points-wrap"></div>
            </div>
            <div class="tap-wrap">
                <div class="tap-head">
                    <h2>MV主播</h2>
                    <span>更多&gt</span>
                </div>
                <div class="tap-nav">
                    <a href="javascript:;">全部</a>
                    <a href="javascript:;">内地</a>
                    <a href="javascript:;">港台</a>
                    <a href="javascript:;">欧美</a>
                    <a href="javascript:;">韩国</a>
                    <a href="javascript:;">日本</a>
                    <div class="smallG"></div>
                </div>
                <div class="tap-content">
                    <ul class="loading"></ul>
                    <ul>
                        <li>
                            <a href="javascript:;">
                                <img src="./img/a.jpg" />
                                <span>君に贈る花がないがないがないがないがないがないがない</span>
                            </a>
                            <div class="tap-discuss">
                                <div class="left">
                                    <span></span>
                                    <span>9167</span>
                                </div>
                                <div class="right">
                                    <span></span>
                                    <span>6</span>
                                </div>
                            </div>
                        </li>
                        <li>
                            <a href="javascript:;">
                                <img src="./img/b.jpg" />
                                <span>君に贈る花がないがないがないがないがないがないがない</span>
                            </a>
                            <div class="tap-discuss">
                                <div class="left">
                                    <span></span>
                                    <span>9167</span>
                                </div>
                                <div class="right">
                                    <span></span>
                                    <span>6</span>
                                </div>
                            </div>
                        </li>
                        <li>
                            <a href="javascript:;">
                                <img src="./img/c.jpg" />
                                <span>君に贈る花がないがないがないがないがないがないがない</span>
                            </a>
                            <div class="tap-discuss">
                                <div class="left">
                                    <span></span>
                                    <span>9167</span>
                                </div>
                                <div class="right">
                                    <span></span>
                                    <span>6</span>
                                </div>
                            </div>
                        </li>
                        <li>
                            <a href="javascript:;">
                                <img src="./img/d.jpg" />
                                <span>君に贈る花がないがないがないがないがないがないがない</span>
                            </a>
                            <div class="tap-discuss">
                                <div class="left">
                                    <span></span>
                                    <span>9167</span>
                                </div>
                                <div class="right">
                                    <span></span>
                                    <span>6</span>
                                </div>
                            </div>
                        </li>
                        <li>
                            <a href="javascript:;">
                                <img src="./img/e.jpg" />
                                <span>君に贈る花がないがないがないがないがないがないがない</span>
                            </a>
                            <div class="tap-discuss">
                                <div class="left">
                                    <span></span>
                                    <span>9167</span>
                                </div>
                                <div class="right">
                                    <span></span>
                                    <span>6</span>
                                </div>
                            </div>
                        </li>
                        <li>
                            <a href="javascript:;">
                                <img src="./img/f.jpg" />
                                <span>君に贈る花がないがないがないがないがないがないがない</span>
                            </a>
                            <div class="tap-discuss">
                                <div class="left">
                                    <span></span>
                                    <span>9167</span>
                                </div>
                                <div class="right">
                                    <span></span>
                                    <span>6</span>
                                </div>
                            </div>
                        </li>
                    </ul>
                    <ul class="loading"></ul>
                </div>
            </div>
            <div class="tap-wrap">
                <div class="tap-head">
                    <h2>MV主播</h2>
                    <span>更多&gt</span>
                </div>
                <div class="tap-nav">
                    <a href="javascript:;">全部</a>
                    <a href="javascript:;">内地</a>
                    <a href="javascript:;">港台</a>
                    <a href="javascript:;">欧美</a>
                    <a href="javascript:;">韩国</a>
                    <a href="javascript:;">日本</a>
                    <div class="smallG"></div>
                </div>
                <div class="tap-content">
                    <ul class="loading"></ul>
                    <ul>
                        <li>
                            <a href="javascript:;">
                                <img src="./img/a.jpg" />
                                <span>君に贈る花がないがないがないがないがないがないがない</span>
                            </a>
                            <div class="tap-discuss">
                                <div class="left">
                                    <span></span>
                                    <span>9167</span>
                                </div>
                                <div class="right">
                                    <span></span>
                                    <span>6</span>
                                </div>
                            </div>
                        </li>
                        <li>
                            <a href="javascript:;">
                                <img src="./img/b.jpg" />
                                <span>君に贈る花がないがないがないがないがないがないがない</span>
                            </a>
                            <div class="tap-discuss">
                                <div class="left">
                                    <span></span>
                                    <span>9167</span>
                                </div>
                                <div class="right">
                                    <span></span>
                                    <span>6</span>
                                </div>
                            </div>
                        </li>
                        <li>
                            <a href="javascript:;">
                                <img src="./img/c.jpg" />
                                <span>君に贈る花がないがないがないがないがないがないがない</span>
                            </a>
                            <div class="tap-discuss">
                                <div class="left">
                                    <span></span>
                                    <span>9167</span>
                                </div>
                                <div class="right">
                                    <span></span>
                                    <span>6</span>
                                </div>
                            </div>
                        </li>
                        <li>
                            <a href="javascript:;">
                                <img src="./img/d.jpg" />
                                <span>君に贈る花がないがないがないがないがないがないがない</span>
                            </a>
                            <div class="tap-discuss">
                                <div class="left">
                                    <span></span>
                                    <span>9167</span>
                                </div>
                                <div class="right">
                                    <span></span>
                                    <span>6</span>
                                </div>
                            </div>
                        </li>
                        <li>
                            <a href="javascript:;">
                                <img src="./img/e.jpg" />
                                <span>君に贈る花がないがないがないがないがないがないがない</span>
                            </a>
                            <div class="tap-discuss">
                                <div class="left">
                                    <span></span>
                                    <span>9167</span>
                                </div>
                                <div class="right">
                                    <span></span>
                                    <span>6</span>
                                </div>
                            </div>
                        </li>
                        <li>
                            <a href="javascript:;">
                                <img src="./img/f.jpg" />
                                <span>君に贈る花がないがないがないがないがないがないがない</span>
                            </a>
                            <div class="tap-discuss">
                                <div class="left">
                                    <span></span>
                                    <span>9167</span>
                                </div>
                                <div class="right">
                                    <span></span>
                                    <span>6</span>
                                </div>
                            </div>
                        </li>
                    </ul>
                    <ul class="loading"></ul>
                </div>
            </div>
        </div>
    </div>
</body>
<script src="./js/tools.js"></script>
<script src="./js/megumi.js"></script>
<script type="text/javascript">
  window.onload = function (){

    document.addEventListener('touchstart', function (ev){
      // ev.preventDefault()
    })

    ;(function (){
      let styleNode = document.createElement('style')
      let w = document.documentElement.clientWidth / 16
      styleNode.innerHTML = "html{font-size:"+ w +"px!important}"
      document.head.appendChild(styleNode)
    })()

    //tap滑屏
    tap()
    function tap(){
      let wrap = document.querySelector('#wrap .content .tap-wrap')
      let w = wrap.offsetWidth
      let contentNodes = document.querySelectorAll('#wrap .content .tap-wrap .tap-content')
      for(let i = 0; i < contentNodes.length; i++){
        move(contentNodes[i])
      }
      function move(content){
        megumi.css(content, 'translateX', -w)

        //点击时手指的位置
        let startPoint = {x: 0, y: 0}
        //点击时滑屏元素的位置
        let elementPoint = {x: 0, y: 0}
        let isX = true
        let isFirst = true
        content.addEventListener('touchstart', function (ev){
          let touchC = ev.changedTouches[0]
          startPoint.x = touchC.clientX
          startPoint.y = touchC.clientY
          elementPoint.x = megumi.css(content, 'translateX')
          elementPoint.y = megumi.css(content, 'translateY')

          isX = true
          isFirst = true
          content.style.transition = 'none'
        })
        content.addEventListener('touchmove', function (ev){
          if(!isX){
            return
          }
          let touchC = ev.changedTouches[0]
          //move的时候当前手指的位置
          let nowPoint = {x: 0, y: 0}
          nowPoint.x = touchC.clientX
          nowPoint.y = touchC.clientY
          //移动的距离
          let dis = {x: 0, y: 0}
          dis.x = nowPoint.x - startPoint.x
          dis.y = nowPoint.y - startPoint.y

          if(isFirst){
            isFirst = false
            if(Math.abs(dis.y) > Math.abs(dis.x)){
              isX = false
              return
            }
          }

          megumi.css(content, 'translateX', elementPoint.x + dis.x)

          jump(dis.x)

          function jump(disX){
            if(Math.abs(disX) > w / 2){
              content.style.transition = '1s transform'
              if(disX > 0){
                megumi.css(content, 'translateX', 0)
              }else{
                megumi.css(content, 'translateX', -2 * w)
              }
            }
          }
        })
        content.addEventListener('touchend', function (ev){
          let touchC = ev.changedTouches[0]
          let nowPoint = {x: 0, y: 0}
          nowPoint.x = touchC.clientX
          let dis = {x: 0, y: 0}
          dis.x = nowPoint.x - startPoint.x

          if(Math.abs(dis.x) <= w / 2){
            content.style.transition = '1s transform'
            megumi.css(content, 'translateX', -w)
          }
        })
      }
    }

    //无缝轮播图
    swiper()
    function swiper(){
      var arr = ['./img/1.jpg', './img/2.jpg', './img/3.jpg', './img/4.jpg', './img/5.jpg']
      megumi.carousel(arr)
    }

    //导航点击变色
    // changeColor()
    function changeColor(){
      let list = document.querySelector('#wrap .content .megumi-nav-drag-wrapper .list')
      let aNodes = document.querySelectorAll('#wrap .content .megumi-nav-drag-wrapper .list > li a')
      list.addEventListener('touchstart', function (){
        this.isMove = false
      })
      list.addEventListener('touchmove', function (){
        this.isMove = true
      })
      list.addEventListener('touchend', function (ev){
        if(this.isMove){
          return
        }
        let touchC = ev.changedTouches[0]
        //只要点击了，就清除所有li的active类
        for(let i = 0; i < aNodes.length; i++){
          tools.removeClass(aNodes[i], 'active')
        }
        tools.addClass(touchC.target, 'active')
        //如果点击的是a标签，给他的父节点添加active
        // if(touchC.target.nodeName.toUpperCase() === 'A'){
        //   tools.addClass(touchC.target.parentNode, 'active')
        // }else if(touchCtarget.nodeName.toUpperCase() === 'LI'){
        //   tools.addClass(touchC.target, 'active')
        // }
      })

    }
    // function changeColor(){
    //   let liNodes = document.querySelectorAll('#wrap .content .megumi-nav-drag-wrapper .list > li')
    //   for(let i = 0; i < liNodes.length; i++){
    //     liNodes[i].addEventListener('touchstart', function (){
    //       this.isMove = false
    //     })
    //     liNodes[i].addEventListener('touchmove', function (){
    //       this.isMove = true
    //     })
    //     liNodes[i].addEventListener('touchend', function (){
    //       if(!this.isMove){
    //         for(let j = 0; j < liNodes.length; j++){
    //           tools.removeClass(liNodes[j], 'active')
    //         }
    //         tools.addClass(this, 'active')
    //       }
    //     })
    //   }
    // }

    //拖拽list
    drag()
    function drag(){
        megumi.dragNav()
    }

    changeFocus()
    function changeFocus(){
      let inputText = document.querySelector("#wrap .head .head-bottom form input[type='text']")
      inputText.addEventListener('touchstart', function (ev){
        inputText.focus()
        ev.stopPropagation()
        ev.preventDefault()
      })
      document.addEventListener('touchstart', function (){
        inputText.blur()
      })
    }

    CMCFMenuBtn()
    function CMCFMenuBtn() {
      let menuBtn = document.querySelector('#wrap .head .head-top .menuBtn')
      let mask = document.querySelector('#wrap .head .mask')
      //一开始遮罩层隐藏
      let flag = false
      menuBtn.addEventListener('touchstart', function (ev){
        if(flag){
          //隐藏遮罩层
          mask.style.display = 'none'
          //移除active类
          tools.removeClass(menuBtn, 'active')
        }else{
          //显示遮罩层
          mask.style.display = 'block'
          //添加active类
          tools.addClass(menuBtn, 'active')
        }
        flag = !flag
        ev.stopPropagation()
        ev.preventDefault()
      })

      //点击其他地方，隐藏mask，menuBtn移除active
      document.addEventListener('touchstart', function (){
        if(flag){
          //隐藏遮罩层
          mask.style.display = 'none'
          //移除active类
          tools.removeClass(menuBtn, 'active')
          flag = !flag
        }
      })
      mask.addEventListener('touchstart', function (ev){
        ev.stopPropagation()
      })
    }

  }
</script>
</html>